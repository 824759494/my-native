<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Echarts地图组件</title>
    <style>
        .geo-map{
            min-height: 600px;
        }
        .yq-map-tip>p{
            margin: 0;
            padding: 0;
            font-size: 12px;
            text-indent: 6px;
            padding-right:8px; 
        }
        .yq-map-text::before{
            content: "●";
            color: #00abff;
            padding-right:8px; 
        }
    </style>
</head>
<body>
    <div class="geo-map"></div>
    <div class="geo-map"></div>
    <script src="http://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="./js/echarts.js" charset="utf-8"></script>
    <script src="./js/world.geo.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/yq-echarts-map.js"></script>
    <script>
        (function(){
            var map = new YQEchartsMap();

            var _json = {"Json":{"charts":[{"type":701,"selection":[{"id":301,"carrier":0},{"id":1305,"carrier":0},{"id":2105,"carrier":0},{"id":801,"carrier":0},{"id":1913,"carrier":0}],"series":[],"list":[{"id":301,"count":20744949,"percent":0.6828},{"id":1305,"count":1756685,"percent":0.0578},{"id":2105,"count":1080510,"percent":0.0356},{"id":801,"count":962412,"percent":0.0317},{"id":1913,"count":828466,"percent":0.0273},{"id":1404,"count":822574,"percent":0.0271},{"id":1103,"count":821849,"percent":0.027},{"id":1201,"count":488481,"percent":0.0161},{"id":605,"count":489144,"percent":0.0161},{"id":2011,"count":395104,"percent":0.013},{"id":704,"count":296825,"percent":0.0098},{"id":1925,"count":213534,"percent":0.007},{"id":206,"count":193901,"percent":0.0064},{"id":1918,"count":138615,"percent":0.0046},{"id":1105,"count":122496,"percent":0.004},{"id":2204,"count":110982,"percent":0.0037},{"id":1318,"count":100798,"percent":0.0033},{"id":1924,"count":95328,"percent":0.0031},{"id":115,"count":73422,"percent":0.0024},{"id":1002,"count":71124,"percent":0.0023},{"id":1803,"count":67879,"percent":0.0022},{"id":902,"count":57155,"percent":0.0019},{"id":2006,"count":53365,"percent":0.0018},{"id":907,"count":40831,"percent":0.0013},{"id":1608,"count":33537,"percent":0.0011},{"id":2001,"count":26445,"percent":0.0009},{"id":604,"count":18381,"percent":0.0006},{"id":2102,"count":13746,"percent":0.0005},{"id":304,"count":16308,"percent":0.0005},{"id":906,"count":14598,"percent":0.0005},{"id":2004,"count":15987,"percent":0.0005},{"id":117,"count":13963,"percent":0.0005},{"id":215,"count":14050,"percent":0.0005},{"id":116,"count":14313,"percent":0.0005},{"id":322,"count":11823,"percent":0.0004},{"id":1314,"count":12976,"percent":0.0004},{"id":503,"count":12689,"percent":0.0004},{"id":707,"count":7970,"percent":0.0003},{"id":1208,"count":9355,"percent":0.0003},{"id":805,"count":9796,"percent":0.0003},{"id":1210,"count":8279,"percent":0.0003},{"id":1202,"count":6158,"percent":0.0002},{"id":1802,"count":6893,"percent":0.0002},{"id":217,"count":4749,"percent":0.0002},{"id":1406,"count":6714,"percent":0.0002},{"id":9009,"count":6649,"percent":0.0002},{"id":1610,"count":6931,"percent":0.0002},{"id":1909,"count":1709,"percent":0.0001},{"id":1101,"count":4039,"percent":0.0001},{"id":1313,"count":2738,"percent":0.0001},{"id":1917,"count":2376,"percent":0.0001},{"id":703,"count":1777,"percent":0.0001},{"id":1907,"count":1682,"percent":0.0001},{"id":1915,"count":2854,"percent":0.0001},{"id":401,"count":3687,"percent":0.0001},{"id":1321,"count":4436,"percent":0.0001},{"id":321,"count":1539,"percent":0.0001},{"id":905,"count":2113,"percent":0.0001},{"id":310,"count":3202,"percent":0.0001},{"id":903,"count":3761,"percent":0.0001},{"id":1914,"count":2554,"percent":0.0001},{"id":504,"count":2320,"percent":0.0001},{"id":1601,"count":1947,"percent":0.0001},{"id":1606,"count":1721,"percent":0.0001},{"id":1319,"count":92,"percent":0.0},{"id":1911,"count":735,"percent":0.0},{"id":208,"count":5,"percent":0.0},{"id":315,"count":1,"percent":0.0},{"id":506,"count":1,"percent":0.0},{"id":2203,"count":137,"percent":0.0},{"id":1306,"count":893,"percent":0.0},{"id":1312,"count":1,"percent":0.0},{"id":1303,"count":4,"percent":0.0},{"id":1322,"count":2,"percent":0.0},{"id":901,"count":186,"percent":0.0},{"id":1102,"count":544,"percent":0.0},{"id":9102,"count":2,"percent":0.0},{"id":205,"count":1143,"percent":0.0},{"id":9702,"count":34,"percent":0.0},{"id":1323,"count":2,"percent":0.0},{"id":9001,"count":1,"percent":0.0},{"id":2007,"count":5,"percent":0.0},{"id":1408,"count":819,"percent":0.0},{"id":712,"count":8,"percent":0.0},{"id":502,"count":709,"percent":0.0},{"id":313,"count":1211,"percent":0.0},{"id":312,"count":2,"percent":0.0},{"id":1920,"count":32,"percent":0.0},{"id":2010,"count":272,"percent":0.0},{"id":9801,"count":3,"percent":0.0},{"id":306,"count":67,"percent":0.0},{"id":1605,"count":41,"percent":0.0},{"id":9202,"count":14,"percent":0.0},{"id":1926,"count":19,"percent":0.0},{"id":1903,"count":281,"percent":0.0},{"id":2602,"count":4,"percent":0.0},{"id":1607,"count":1200,"percent":0.0},{"id":1407,"count":12,"percent":0.0},{"id":218,"count":27,"percent":0.0},{"id":213,"count":18,"percent":0.0},{"id":211,"count":10,"percent":0.0},{"id":203,"count":233,"percent":0.0},{"id":104,"count":3,"percent":0.0},{"id":9004,"count":5,"percent":0.0},{"id":2104,"count":169,"percent":0.0},{"id":1905,"count":51,"percent":0.0},{"id":1923,"count":1,"percent":0.0},{"id":1701,"count":20,"percent":0.0},{"id":1302,"count":215,"percent":0.0},{"id":1109,"count":454,"percent":0.0},{"id":102,"count":9,"percent":0.0},{"id":904,"count":145,"percent":0.0},{"id":319,"count":969,"percent":0.0},{"id":1204,"count":2,"percent":0.0},{"id":302,"count":238,"percent":0.0},{"id":204,"count":25,"percent":0.0},{"id":112,"count":38,"percent":0.0},{"id":9603,"count":10,"percent":0.0},{"id":9602,"count":1,"percent":0.0},{"id":2101,"count":1,"percent":0.0},{"id":1308,"count":1102,"percent":0.0},{"id":9006,"count":43,"percent":0.0},{"id":705,"count":14,"percent":0.0},{"id":2003,"count":8,"percent":0.0},{"id":1401,"count":10,"percent":0.0},{"id":804,"count":22,"percent":0.0},{"id":1003,"count":187,"percent":0.0},{"id":1206,"count":2,"percent":0.0},{"id":1916,"count":3,"percent":0.0},{"id":2501,"count":3,"percent":0.0},{"id":2601,"count":5,"percent":0.0},{"id":9203,"count":7,"percent":0.0},{"id":106,"count":1,"percent":0.0},{"id":1108,"count":148,"percent":0.0},{"id":1403,"count":33,"percent":0.0},{"id":1410,"count":543,"percent":0.0},{"id":320,"count":29,"percent":0.0},{"id":1602,"count":1,"percent":0.0},{"id":2202,"count":445,"percent":0.0},{"id":1501,"count":195,"percent":0.0},{"id":103,"count":975,"percent":0.0},{"id":323,"count":1,"percent":0.0},{"id":1908,"count":1,"percent":0.0},{"id":1107,"count":1,"percent":0.0},{"id":1301,"count":150,"percent":0.0},{"id":1203,"count":191,"percent":0.0},{"id":113,"count":551,"percent":0.0},{"id":1304,"count":1,"percent":0.0},{"id":802,"count":2,"percent":0.0},{"id":1001,"count":73,"percent":0.0},{"id":2103,"count":1371,"percent":0.0},{"id":2005,"count":4,"percent":0.0},{"id":505,"count":5,"percent":0.0},{"id":303,"count":189,"percent":0.0},{"id":1928,"count":200,"percent":0.0},{"id":1921,"count":1,"percent":0.0},{"id":1912,"count":1,"percent":0.0},{"id":1804,"count":26,"percent":0.0},{"id":207,"count":5,"percent":0.0},{"id":1604,"count":1,"percent":0.0},{"id":1209,"count":2,"percent":0.0},{"id":908,"count":7,"percent":0.0},{"id":501,"count":9,"percent":0.0},{"id":316,"count":7,"percent":0.0},{"id":216,"count":23,"percent":0.0},{"id":318,"count":331,"percent":0.0},{"id":404,"count":83,"percent":0.0},{"id":1316,"count":714,"percent":0.0},{"id":603,"count":227,"percent":0.0},{"id":1603,"count":251,"percent":0.0},{"id":1902,"count":5,"percent":0.0},{"id":1919,"count":25,"percent":0.0},{"id":1930,"count":225,"percent":0.0},{"id":2012,"count":1,"percent":0.0},{"id":201,"count":2,"percent":0.0},{"id":714,"count":2,"percent":0.0},{"id":202,"count":53,"percent":0.0},{"id":210,"count":10,"percent":0.0},{"id":212,"count":252,"percent":0.0},{"id":219,"count":104,"percent":0.0},{"id":702,"count":2,"percent":0.0},{"id":9701,"count":4,"percent":0.0}]}]},"Code":0};
            //console.log(_I18,_I18.data);
            var _result = _json.Json.charts[0].list;
            
            /**
             * 将ajax拿到的数据跟词条数据进行关联
             **/
            function i18Data(result,i18n){
                //_tempObj 存储ajax拿到的每一个对象的临时数据
                //_tempI18 储存词条的临时数据
                var _ind = 0,_templen = 0,_tempObj,_tempI18,_i18nData = [];
                for(_ind;_ind < result.length; _ind++){
                    _tempObj = result[_ind];
                    if(_tempObj.constructor === Object && _tempObj.hasOwnProperty("id")){
                        _templen = (_tempObj.id).toString().length;
                        switch (_templen) {
                            case 3:
                                _tempI18 = i18n["0" + (_tempObj.id.toString())];
                                break;
                            case 4:
                                _tempI18 = i18n[_tempObj.id.toString()];
                                break;
                            default:
                                _tempI18 = false;
                                break;
                        }
                        if(_tempI18){
                            _i18nData.push({
                                _name:_tempI18._name,
                                //idt:_tempI18._mnemonic,
                                key:_tempI18.key,
                                value:_tempObj.count,
                                percent:(_tempObj.percent * 100).toFixed(2)
                            })
                        }
                    }
                }
                return _i18nData;
            }

            var _tempName = "",_tempValue = 0,_tempPercent = "0.00%",
                _tempNameI = "国家/地区：",_tempValueI = "数量：",_tempPercentI = "百分比：";
            map.initConfig({
                g:{
                    tooltip : {
                        formatter: function (params, ticket, callback) {
                            _tempName = "",_tempValue = 0,_tempPercent = "0.00%";
                            if(params.hasOwnProperty("data") && params.data.constructor === Object){
                                if(params.data.hasOwnProperty("_name")){
                                    _tempName = params.data._name;
                                }else{
                                    return;
                                }
                                if(params.data.hasOwnProperty("value")){
                                    _tempValue = params.data.value;
                                }else{
                                    return;
                                }
                                if(params.data.hasOwnProperty("percent")){
                                    _tempPercent = params.data.percent + "%";
                                }else{
                                    return;
                                }
                            }
                            return '<div class="yq-map-tip"><p class="yq-map-text">' + _tempNameI + _tempName + '</p><p class="yq-map-text">' + _tempValueI + _tempValue + '</p><p class="yq-map-text">' + _tempPercentI + _tempPercent + '</p></div>';
                        }
                    }
                }
            })

            map.autoI18n({
                key : "key",
                type : 2,
                data : [i18Data(_result,_I18.data)]
            })

            var _ec = map.setOption();

           /*  map.mapSelect({
                dataIndex : 0
            }) */
        })()
        
    </script>
</body>
</html>